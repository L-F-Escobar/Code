<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- <link rel="shortcut icon" href="favicon.ico" /> -->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <!-- <link rel="shortcut icon" href="#"> -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Serverless url shortener</title>
    <link href="paper.min.css" rel="stylesheet" />
  </head>
  <style>
    * {
      text-align: center;
    }

    html, body {
        background-color: #22923b !important;
    }
    
    #message {
      display: none;
    }
  </style>
  <script src="jquery-3.2.1.min.js"></script>
  <body>
    <div class="row flex-center">
      <div class="col-8 col">
        <h2>SERVERLESS WEBSITE</h2>
        <form id="api_gateway_form" action="https://n7emucgrb1.execute-api.us-east-1.amazonaws.com/dev/shorten/">
          <div class="form-group">
            <label for="url">Enter URL to shorten</label>
            <input
              onblur="if(this.value==''){ this.value='https:\/\/example.com'; this.style.color='#BBB';}"
              onfocus="if(this.value=='https:\/\/example.com'){ this.value=''; this.style.color='#000';}""
              class="input-block"
              name="url"
              type="url"
              id="url"
              autocomplete="off"
              required
            />
          </div>
          <div id="message" class="alert alert-primary"></div>
          <input class="paper-btn" type="submit" value="Shorten link" />
        </form>

        <p class="padding-top">
          <a href="https://github.com/LEscobar-Driver" target=_blank>AUTHOR</a>
        </p>
      </div>
    </div>

    <script>
      $('api_gateway_form').submit(function(event) {
        event.preventDefault()
        // addMessage('ONE')
        console.log(`event.target.action --> ${event.target.action}`)
        console.log(`event.target.url.value --> ${event.target.url.value}`)
        console.log(`vanity --> ${vanity}`)
        console.log(`location.href --> ${location.href}`)
        // document.write("HELLO FROM FUCK TOWN 666 ");
        // document.write(event.target.action);
        // document.write(event.target.url.value);
        // document.write(vanity);
        // document.write(location.href);
        // var vanity = new URL(location.href).searchParams.get('vanity')
        addMessage('...')
        // ignoreFavicon(event.target.action, event.target.url.value, shortenUrlLink)
        shortenUrlLink(event.target.action, event.target.url.value)
      })

      // function ignoreFavicon(apiUrl, longUrl, shortenUrlLink) {
      //   console.log(`ignoreFavicon`)
      //   if (req.originalUrl && req.originalUrl.split("/").pop() === 'favicon.ico') {
      //     console.log(`ignoreFavicon 999`)
      //     return res.sendStatus(204);
      //   }
      //   console.log(`ignoreFavicon111`)
      //   return shortenUrlLink(event.target.action, event.target.url.value);
      // }

      function shortenUrlLink(apiUrl, longUrl) {
        console.log(`apiUrl --> ${apiUrl}`)
        console.log(`longUrl --> ${longUrl}`)
        $.ajax(apiUrl, {
          type: 'POST',
          data: JSON.stringify({ url: longUrl})
        })
          .done(function(responseJSON) {
            var shortUrl =
              window.location.protocol +
              '//' +
              window.location.host +
              '/' +
              responseJSON.path
            addMessage(shortUrl)
          })
          .fail(function(data) {
            if (data.status === 400) {
              addMessage(data.responseJSON.message)
            } else {
              addMessage(data.responseJSON.message)
            }
          })
      }

      function addMessage(text) {
        $('#message').text(text).show()
      }
    </script>
  </body>
</html>